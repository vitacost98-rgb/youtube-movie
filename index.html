<!DOCTYPE html>
<html lang="zh-TW" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube 影片研究員 - 檔案選取工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <script>
        // --- [Google API 設定] ---
        const CLIENT_ID = '107140118174-mm7cbcacd1evj72plq2b9pm6f1gf9fk4.apps.googleusercontent.com'; 
        const API_KEY = ""; // 建議於本機測試時可留空，或填入您的 API Key
        const SCOPES = 'https://www.googleapis.com/auth/drive.readonly https://www.googleapis.com/auth/drive.metadata.readonly';
        // -------------------------

        const PROJECT_NUMBER = CLIENT_ID.split('-')[0];
        let tokenClient;
        let accessToken = null;

        // 初始化 Google API
        function gapiLoaded() {
            gapi.load('client:picker', async () => {
                try {
                    await gapi.client.init({
                        apiKey: API_KEY,
                        discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest']
                    });
                } catch (e) { console.error("GAPI Error:", e); }
            });
        }

        function gisLoaded() {
            try {
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID,
                    scope: SCOPES,
                    ux_mode: 'popup', 
                    callback: (resp) => {
                        if (resp.error) return alert("授權失敗");
                        accessToken = resp.access_token;
                        document.getElementById('auth-status').innerHTML = `<span class="flex items-center text-emerald-400 font-bold"><i class="fas fa-check-circle mr-2"></i> 已成功連線至 Google Drive</span>`;
                        document.getElementById('picker-btn').disabled = false;
                        document.getElementById('picker-btn').classList.replace('opacity-50', 'opacity-100');
                    },
                });
            } catch (e) { console.error("GIS Error:", e); }
        }

        function handleAuthClick() {
            if (!tokenClient) return alert("API 初始化中，請稍候...");
            tokenClient.requestAccessToken({ prompt: 'select_account' });
        }

        function createPicker() {
            if (!accessToken) return alert("請先連結 Google 帳號");
            const view = new google.picker.DocsView(google.picker.ViewId.DOCS)
                .setMimeTypes('application/vnd.google-apps.document,text/plain,application/pdf,video/mp4,video/quicktime');
            
            const picker = new google.picker.PickerBuilder()
                .enableFeature(google.picker.Feature.MULTISELECT_ENABLED)
                .setAppId(PROJECT_NUMBER)
                .setOAuthToken(accessToken)
                .addView(view)
                .setCallback(pickerCallback)
                .build();
            picker.setVisible(true);
        }

        async function pickerCallback(data) {
            if (data.action === google.picker.Action.PICKED) {
                const names = data.docs.map(doc => doc.name);
                const fileListArea = document.getElementById('file-list-display');
                const rawText = document.getElementById('raw-names');
                
                fileListArea.innerHTML = names.map(name => `
                    <div class="bg-slate-800/80 p-3 rounded-lg border border-emerald-500/30 mb-2 flex items-center">
                        <i class="fas fa-video text-emerald-400 mr-3"></i>
                        <span class="text-slate-200 text-sm">${name}</span>
                    </div>
                `).join('');
                
                rawText.value = names.join('\n');
                document.getElementById('result-section').classList.remove('hidden');
            }
        }

        function copyToClipboard() {
            const copyText = document.getElementById("raw-names");
            copyText.select();
            document.execCommand("copy");
            alert("檔案名稱已複製！請貼回給 AI 進行分析。");
        }
    </script>
    <script src="https://accounts.google.com/gsi/client" onload="gisLoaded()" async defer></script>
    <script src="https://apis.google.com/js/api.js" onload="gapiLoaded()" async defer></script>

    <style>
        body { background-color: #0f172a; font-family: 'Inter', sans-serif; }
        .glass-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .gradient-text { background: linear-gradient(135deg, #10b981 0%, #06b6d4 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    </style>
</head>
<body class="p-4 md:p-12 min-h-screen flex items-center justify-center">

    <div class="max-w-2xl w-full space-y-8 glass-card p-8 rounded-3xl shadow-2xl">
        <div class="text-center">
            <h1 class="text-4xl font-black gradient-text mb-2">YouTube 研究員選取器</h1>
            <p class="text-slate-400 text-sm">安全登入並選取您要分析的影片檔案</p>
        </div>

        <div class="space-y-6">
            <!-- 步驟一：授權 -->
            <div class="bg-slate-900/50 p-6 rounded-2xl border border-slate-700">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-xs font-bold text-slate-500 uppercase tracking-widest">第一步：連結帳號</span>
                    <div id="auth-status" class="text-xs text-slate-400 italic">尚未連線</div>
                </div>
                <button onclick="handleAuthClick()" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-xl transition flex items-center justify-center gap-2">
                    <i class="fab fa-google"></i> 登入 Google 雲端硬碟
                </button>
            </div>

            <!-- 步驟二：選取檔案 -->
            <div class="bg-slate-900/50 p-6 rounded-2xl border border-slate-700">
                <span class="text-xs font-bold text-slate-500 uppercase tracking-widest block mb-4">第二步：選取影片</span>
                <button id="picker-btn" onclick="createPicker()" disabled class="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-3 rounded-xl transition opacity-50 flex items-center justify-center gap-2">
                    <i class="fas fa-file-video"></i> 開啟檔案選取視窗 (最多5個)
                </button>
            </div>

            <!-- 結果區 -->
            <div id="result-section" class="hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
                <div class="bg-slate-900/80 p-6 rounded-2xl border border-emerald-500/50">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-xs font-bold text-emerald-400 uppercase tracking-widest">已選取檔案名稱</span>
                        <button onclick="copyToClipboard()" class="text-xs bg-slate-700 hover:bg-slate-600 px-3 py-1 rounded-md text-slate-200 transition">
                            <i class="far fa-copy mr-1"></i> 複製清單
                        </button>
                    </div>
                    <div id="file-list-display" class="mb-4"></div>
                    <textarea id="raw-names" class="hidden"></textarea>
                    <div class="text-center p-4 bg-emerald-500/10 rounded-lg">
                        <p class="text-emerald-400 text-sm font-medium">請將上述名稱複製並貼回給 AI 研究員！</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center">
            <p class="text-slate-500 text-[10px] uppercase tracking-tighter">本工具僅於本機執行，不會儲存任何資料</p>
        </div>
    </div>

</body>
</html>